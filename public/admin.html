<!doctype html>
<html lang="zh-Hant"><meta charset="utf-8">
<title>立國實業｜訂單列表</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<body class="bg-light" style="font-family:system-ui;">
  <div class="container my-4">
    <h2 class="mb-3">訂單列表（最近 200 筆）</h2>
    <div class="table-responsive">
      <table class="table table-sm table-hover align-middle bg-white shadow-sm">
        <thead class="table-light">
          <tr>
            <th>訂單編號</th><th>客戶</th><th>電話</th><th>Email</th><th>金額</th>
            <th>狀態</th><th>時間</th><th>操作</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
  <script>
    const STATUS = ["PENDING","PAID","PROCESSING","SHIPPED","COMPLETED","CANCELLED"];
    async function load(){
      const list = await (await fetch('/api/admin/orders')).json();
      rows.innerHTML = list.map(o=>`
        <tr data-order="${o.orderNo}">
          <td>${o.orderNo}</td>
          <td>${o.name}</td>
          <td>${o.phone}</td>
          <td>${o.email}</td>
          <td>NT$ ${o.total}</td>
          <td>
            <select class="form-select form-select-sm">
              ${STATUS.map(s=>`<option value="${s}" ${s===o.status?'selected':''}>${s}</option>`).join('')}
            </select>
          </td>
          <td>${o.createdAt}</td>
          <td><button class="btn btn-sm btn-dark" onclick="save(this)">儲存</button></td>
        </tr>
      `).join('');
    }
    async function save(btn){
      const tr = btn.closest('tr');
      const orderNo = tr.dataset.order;
      const status = tr.querySelector('select').value;
      await fetch('/api/admin/update-status', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ orderNo, status })
      });
      btn.classList.remove('btn-dark'); btn.classList.add('btn-success'); btn.textContent='已儲存';
      setTimeout(()=>{ btn.classList.add('btn-dark'); btn.classList.remove('btn-success'); btn.textContent='儲存'; }, 1200);
    }
    load();
  </script>
</body></html>
